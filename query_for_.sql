-- GET THE TABLE BACKUP 
SELECT OWNERID,FIA_ex5_ID,FIA_ex5_4 INTO FIA_ex5_BKP_23122024 FROM FIA_ex5 WHERE OWNERID=985;
 
-- UPDATE THE VALUES FROM HISTORY TABLE
UPDATE FIA
SET FIA.FIA_ex5_4 = (
    SELECT TOP 1 FIA_ex5_4
    FROM FIA_ex5_HS FI_H
    WHERE FI_H.OWNERID = FIA.OWNERID
	AND FI_H.FIA_ex5_ID = FIA.FIA_ex5_id
      AND (FI_H.FIA_ex5_4 <> 'NA' OR FI_H.FIA_ex5_4 IS NOT NULL)
    ORDER BY FI_H.HISTORYID
)
FROM FIA_ex5 FIA
WHERE OWNERID = 985 AND FIA_ex5_4 = 'NA' AND STATUSCODEID NOT IN (100117,100079,6467,6468,100033);

------------------------------

-- BKP QUERY 
SELECT OWNERID,FIA_Ex4_id,FIA_Ex4_139 INTO FIA_ex4_BKP23122024 FROM FIA_ex4;
 
-- QUERY TO UPDATE NULL
UPDATE FIA_Ex4
SET FIA_Ex4_139=NULL
WHERE OWNERID=985 AND FIA_Ex4_ID IN (
SELECT 
FIA_Ex4_id
FROM FIA_ex4 e
WHERE e.OWNERID = 985
  AND e.FIA_ex4_139 = 0
  AND NOT EXISTS (
      SELECT 1 
      FROM Approval a
      WHERE
	  OWNERID=985 and RelatedToTypeId=100286 AND RelatedToId=e.FIA_ex4_ID  )
	  )
	  AND STATUSCODEID NOT IN (100117,100079,6467,6468,100033)
	  
	  ;
	  
	  